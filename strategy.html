<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/logo.png" type="image/png">
    <title>æˆ˜ç•¥å®šä½ | é“æ¯…ç¥¥</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="ios-theme sub-page">
    <div class="background-mesh mesh-red"></div>

    <nav class="top-nav">
        <a href="index.html" class="back-btn">â† è¿”å›</a>
        <span class="page-title" style="display:flex; align-items:center;">
            <img src="assets/logo.png" style="width:24px; height:24px; margin-right:8px; border-radius:50%;">
            æˆ˜ç•¥å®šä½
        </span>
    </nav>

    <main class="content-scroll">

        <!-- HEADER -->
        <header style="margin-bottom: 40px; padding: 0 10px;">
            <div class="badge-header" style="background: var(--system-red); color: #fff;">STRATEGY 2024</div>
            <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 15px; line-height: 1.2;">
                æ ¸å¿ƒæˆ˜ç•¥å®šä½ï¼š<br><span style="color:var(--system-red);">å·®å¼‚åŒ–çªå›´æˆ˜</span>
            </h1>
            <div class="glass-card" style="padding: 20px; border-radius: 20px; background: rgba(255,255,255,0.4);">
                <p style="font-size: 14px; line-height: 1.6; color: var(--text-primary);">
                    <strong>ç°çŠ¶åˆ¤æ–­ï¼š</strong> å¸‚åœºä¸Šç‰›è‚‰æ³¡é¦ã€å°ç‚’æ³¡é¦çš„ç«äº‰è€…ï¼ˆå¦‚é©¬æ´ªã€è€åˆ˜å®¶ï¼‰å·²ç»ç§°ç‹ (King)ã€‚<br>
                    æ­£é¢ç¡¬åˆš = æ‰¾æ­»ã€‚<br>
                    <strong>å”¯ä¸€ç ´å±€ç‚¹ï¼š</strong> <span
                        style="background:rgba(255,59,48,0.1); color:var(--system-red); padding:2px 6px; border-radius:4px; font-weight:700;">ç¾Šè‚‰æ³¡é¦</span>
                </p>
            </div>
        </header>

        <!-- 1. MARKET ANALYSIS -->
        <section class="glass-sheet">
            <h2>
                <div class="section-marker" style="background:var(--system-red); color:#fff;">1</div>
                æˆ˜åœºå±€åŠ¿æ¨æ¼”
            </h2>
            <div class="sheet-content">
                <div class="comparison-box" style="margin-top:0;">
                    <!-- Competitors -->
                    <div class="comp-item poor"
                        style="background: rgba(255,59,48,0.05); border-color: rgba(255,59,48,0.1);">
                        <div style="font-size:12px; font-weight:700; color:var(--system-red); margin-bottom:5px;">RED
                            OCEAN (çº¢æµ·)</div>
                        <div style="font-size:18px; font-weight:800; margin-bottom:5px;">ç‰›è‚‰/å°ç‚’èµ›é“</div>
                        <p style="font-size:13px; opacity:0.7; line-height:1.4;">
                            é©¬æ´ªã€è€åˆ˜å®¶ç­‰å¤´éƒ¨å“ç‰Œå·²å é¢†å¿ƒæ™ºã€‚<br>
                            <em>"æƒ³åƒå°ç‚’å»é©¬æ´ª"</em> å·²æˆå®šå±€ã€‚
                        </p>
                    </div>

                    <!-- Opportunity -->
                    <div class="comp-item success"
                        style="background: rgba(52,199,89,0.1); border-color: rgba(52,199,89,0.2);">
                        <div style="font-size:12px; font-weight:700; color:var(--system-green); margin-bottom:5px;">BLUE
                            OCEAN (æœºä¼š)</div>
                        <div style="font-size:18px; font-weight:800; margin-bottom:5px; color:var(--system-green);">
                            ç¾Šè‚‰æ³¡é¦èµ›é“</div>
                        <p style="font-size:13px; opacity:0.8; line-height:1.4; color:var(--text-primary);">
                            è™½ç„¶å¤§å®¶ä¹Ÿå–ç¾Šè‚‰ï¼Œä½†æ²¡äººæŠŠ"ç¾Šè‚‰"å–Šå¾—æœ€å“ã€‚<br>
                            <strong>æˆ˜ç•¥æœºä¼šï¼š</strong> åªæœ‰æˆ‘ä»¬æ•¢æŠŠç¾Šè‚‰æ³¡å½“æ‹›ç‰Œæ‰“ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. TARGET AUDIENCE -->
        <section class="glass-sheet">
            <h2>
                <div class="section-marker" style="background:var(--system-blue); color:#fff;">2</div>
                ç›®æ ‡å®¢ç¾¤é”å®š
            </h2>
            <div class="sheet-content">
                <div class="verbatim-box">
                    <strong>æˆ˜ç•¥å†³ç­–ï¼š</strong> æ”¾å¼ƒå¯¹æœ¬åœ°äººçš„è¿‡åº¦è®¨å¥½ï¼Œå…¨å¿ƒå…¨æ„æœåŠ¡å¤–åœ°æ¸¸å®¢ã€‚
                </div>

                <div style="display:grid; gap:15px; margin-top:20px;">
                    <div class="highlight-box">
                        <strong style="color:var(--text-primary); font-size:14px;">ç”¨æˆ·å¿ƒç†ç”»åƒ (æ¸¸å®¢)</strong>
                        <p style="font-size:13px; margin-top:8px; line-height:1.5; color:var(--text-secondary);">
                            ä»–ä»¬ä¸ä¸€å®šèƒ½åƒå‡ºå“ªå®¶æœ€å¥½åƒï¼Œä½†ä»–ä»¬æœ€å®³æ€•<strong>"è¸©é›·"</strong>ã€‚
                            ä»–ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ª<span
                                style="color:#000; font-weight:700; background:var(--system-yellow);">"å¿ƒç†å®‰å…¨åŒº"</span>ã€‚
                        </p>
                        <div
                            style="margin-top:10px; font-size:12px; background:rgba(0,0,0,0.03); padding:10px; border-radius:8px;">
                            å…³é”®è¯ï¼š<strong>ä¸è¸©é›·</strong>ã€<strong>æ­£å®—</strong>ã€<strong>15å¹´è€åº—</strong>ã€<strong>æ²¡æœ‰å¥—è·¯</strong>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. BENCHMARK -->
        <section class="glass-sheet">
            <h2>
                <div class="section-marker" style="background:var(--system-orange); color:#fff;">3</div>
                å¯¹æ ‡æ¡ˆä¾‹é€»è¾‘
            </h2>
            <div class="sheet-content">
                <div class="highlight-box" style="border-left: 4px solid var(--system-orange);">
                    <h3 style="font-size:15px; font-weight:800; margin-bottom:5px;">å‚è€ƒæ¡ˆä¾‹ï¼šå—å‘çƒ¤å…¨é±¼</h3>
                    <p style="font-size:13px; line-height:1.5;">
                        <strong>åšæ³•ï¼š</strong> å¸‚åœºä¸Šçƒ¤é±¼ç§ç±»å¤šï¼Œä»–ä»¬ä¸è´ªå¤šï¼Œåªé€‰"é©¬æ²¹é±¼"è¿™ä¸€ç§æœ€å¥½åƒçš„é±¼æ­»ç£•ï¼Œæ‰“å‡º"å—å‘çƒ¤é©¬æ²¹é±¼"çš„æ‹›ç‰Œã€‚
                    </p>
                    <div
                        style="margin-top:10px; padding-top:10px; border-top:1px dashed rgba(0,0,0,0.1); font-size:13px;">
                        <strong>é“æ¯…ç¥¥å€Ÿé‰´ï¼š</strong><br>
                        æˆ‘ä»¬ä¸è´ªå¤šï¼Œå°±ä»èœå•é‡Œæ‹å‡ºä¸€ä¸ª<strong>"ç²¾å“ç¾Šè‚‰æ³¡"</strong>æ­»ç£•ã€‚<br>
                        è®©å®ƒæˆä¸ºåº—é‡Œçš„"é©¬æ²¹é±¼"â€”â€”<strong>å¿…åƒå•å“</strong>ã€‚
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. SLOGAN -->
        <section class="glass-card"
            style="text-align:center; padding:40px 20px; background:#fff; border:none; box-shadow:0 10px 40px rgba(0,0,0,0.08);">
            <div
                style="font-size:12px; letter-spacing:2px; color:var(--text-secondary); margin-bottom:10px; text-transform:uppercase;">
                Final Strategy Slogan</div>
            <h1 style="font-size:32px; font-weight:900; line-height:1.3; color:#000; margin-bottom:15px;">
                <span style="color:var(--system-red);">æ­£å®—ç¾Šè‚‰æ³¡</span><br>
                è®¤å‡†é“ä¸€å··
            </h1>
            <p style="font-size:13px; color:var(--text-secondary); max-width:280px; margin:0 auto;">
                é€šè¿‡"15å¹´è€åº—"èƒŒä¹¦ + "ç¾Šè‚‰"å·®å¼‚åŒ–ï¼Œå é¢†"ç¾Šè‚‰æ³¡ä¹‹ç‹"çš„è®¤çŸ¥é«˜åœ°ã€‚
            </p>
        </section>

    </main>

    <!-- 5. STRATEGY MEMOS (Dynamic) -->
    <section class="glass-sheet" style="margin: 20px 24px 60px;">
        <h2 style="margin-bottom: 20px;">
            <div class="section-marker" style="background:#5856D6; color:#fff;">ğŸ“</div>
            æˆ˜ç•¥å¤‡å¿˜å½•
        </h2>
        <div class="sheet-content">
            <!-- Add New -->
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="memo-input" placeholder="è¾“å…¥å¤‡å¿˜å†…å®¹ (å¦‚: ç¾Šè‚‰è¦åˆ‡åšä¸€ç‚¹...)"
                    style="flex:1; padding:12px; border-radius:12px; border:1px solid rgba(0,0,0,0.1); background:rgba(255,255,255,0.5);">

                <!-- Voice Button -->
                <button id="mic-btn" onclick="toggleRecording()"
                    style="width:44px; padding:0; background:rgba(0,0,0,0.05); color:#333; border:none; border-radius:12px; font-size:20px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.3s;">
                    ğŸ™ï¸
                </button>

                <button id="add-btn" onclick="addMemo()"
                    style="padding:12px 20px; background:var(--system-blue); color:#fff; border:none; border-radius:12px; font-weight:600; cursor:pointer;">
                    + è®°å½•
                </button>
            </div>

            <!-- Recording Status -->
            <div id="recording-status"
                style="display:none; align-items:center; gap:10px; margin-bottom:15px; padding:10px; background:rgba(255,59,48,0.1); border-radius:8px; color:#FF3B30;">
                <div
                    style="width:10px; height:10px; background:#FF3B30; border-radius:50%; animation: pulse 1s infinite;">
                </div>
                <span style="font-size:12px; font-weight:600;">æ­£åœ¨å½•éŸ³... (å†æ¬¡ç‚¹å‡»éº¦å…‹é£ç»“æŸå¹¶å‘é€)</span>
            </div>

            <!-- List -->
            <div id="memo-list" style="display:grid; gap:10px;">
                <div style="text-align:center; color:#999; padding:20px;">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </section>

    <!-- LeanCloud SDK & Logic -->
    <script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <script>
        // CONFIG
        const CLOUD_CONFIG_STRAT = {
            appId: "Ru4pzaooijH8G6ICWOJEirUj-MdYXbMMI",
            appKey: "KJF0dXD0lmOMn1PJDb3fMUN5",
            serverURLs: "https://ru4pzaoo.api.lncldglobal.com"
        };
        // Global Record Variables
        let mediaRecorder;
        let audioChunks = [];

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Polling for AV init (Wait max 5s)
            let attempts = 0;
            const initInterval = setInterval(() => {
                attempts++;
                if (typeof AV !== 'undefined') {
                    // Init if not yet
                    if (!AV.applicationId) AV.init(CLOUD_CONFIG_STRAT);
                    clearInterval(initInterval);
                    loadMemosWithRetry(3); // Start Loading with 3 Retries
                } else if (attempts > 50) { // 5s timeout
                    clearInterval(initInterval);
                    const errHTML = '<div style="color:red; text-align:center;">SDK Load Timeout</div>';
                    document.getElementById('memo-list').innerHTML = errHTML;
                }
            }, 100);
        });

        // --- RECORDING LOGIC ---
        async function toggleRecording() {
            const btn = document.getElementById('mic-btn');
            const status = document.getElementById('recording-status');
            const input = document.getElementById('memo-input');
            const addBtn = document.getElementById('add-btn');

            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                // START RECORDING
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        await uploadVoiceMemo(audioBlob);
                    };

                    mediaRecorder.start();

                    // UI Update
                    btn.style.background = '#FF3B30';
                    btn.style.color = '#fff';
                    btn.innerHTML = 'â¹';
                    status.style.display = 'flex';
                    input.disabled = true;
                    addBtn.disabled = true;

                } catch (e) {
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£: ' + e.message);
                }
            } else {
                // STOP RECORDING
                mediaRecorder.stop();

                // UI Reset
                btn.style.background = 'rgba(0,0,0,0.05)';
                btn.style.color = '#333';
                btn.innerHTML = 'ğŸ™ï¸';
                status.style.display = 'none';
                input.disabled = false;
                addBtn.disabled = false;

                // Show loading
                const container = document.getElementById('memo-list');
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'voice-uploading';
                loadingDiv.innerHTML = '<div style="text-align:center; padding:10px; color:#999;">ğŸ™ï¸ æ­£åœ¨ä¸Šä¼ è¯­éŸ³...</div>';
                container.prepend(loadingDiv);
            }
        }

        async function uploadVoiceMemo(blob) {
            try {
                // 1. Upload File
                const file = new AV.File('voice_memo.webm', blob);
                const savedFile = await file.save();

                // 2. Create Memo Object
                const Memo = AV.Object.extend('StrategyMemo');
                const memo = new Memo();
                memo.set('content', '[è¯­éŸ³å¤‡å¿˜]');
                memo.set('audio', savedFile.url()); // Store URL
                memo.set('isVoice', true);

                const acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                memo.setACL(acl);

                await memo.save();

                // 3. Remove Loading & Refresh
                const loadingDiv = document.getElementById('voice-uploading');
                if (loadingDiv) loadingDiv.remove();
                loadMemosWithRetry(3);

            } catch (e) {
                alert("è¯­éŸ³ä¸Šä¼ å¤±è´¥: " + e.message);
                const loadingDiv = document.getElementById('voice-uploading');
                if (loadingDiv) loadingDiv.remove();
            }
        }

        async function loadMemosWithRetry(retries) {
            const container = document.getElementById('memo-list');
            if (retries === 3) container.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">æ­£åœ¨è¿æ¥äº‘ç«¯...</div>';

            try {
                const query = new AV.Query('StrategyMemo');
                query.descending('createdAt');
                // Timeout for query itself (5s)
                const results = await Promise.race([
                    query.find(),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Query Timeout')), 5000))
                ]);

                container.innerHTML = '';
                if (results.length === 0) {
                    container.innerHTML = '<div style="text-align:center; opacity:0.5; padding:20px; font-size:13px;">æš‚æ— å¤‡å¿˜ï¼Œéšæ‰‹è®°ä¸€æ¡å§~</div>';
                    return;
                }

                results.forEach(memo => {
                    const div = document.createElement('div');
                    div.className = 'verbatim-box';
                    div.style.cssText = 'display:flex; flex-direction:column; gap:8px; margin-bottom:8px; background:rgba(255,255,255,0.6); padding:12px;';

                    const content = memo.get('content');
                    const audioUrl = memo.get('audio');
                    const date = memo.createdAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    let html = `<div style="display:flex; justify-content:space-between; width:100%;">
                        <span style="font-size:14px; color:#333;">${content} <span style="font-size:10px; color:#999; margin-left:5px;">${date}</span></span>
                        <button onclick="deleteMemo('${memo.id}')" style="background:none; border:none; color:#ccc; font-size:12px; cursor:pointer;">ğŸ—‘ï¸</button>
                    </div>`;

                    if (audioUrl) {
                        html += `<audio controls src="${audioUrl}" style="width:100%; height:32px; margin-top:5px;"></audio>`;
                    }

                    div.innerHTML = html;
                    container.appendChild(div);
                });
            } catch (e) {
                console.warn(`Load Attempt Failed (Left: ${retries})`, e);
                if (retries > 0) {
                    container.innerHTML = `<div style="text-align:center; color:#ff9500; padding:20px; font-size:12px;">è¿æ¥ä¸ç¨³å®šï¼Œæ­£åœ¨é‡è¯• (${3 - retries + 1}/3)...</div>`;
                    setTimeout(() => loadMemosWithRetry(retries - 1), 1500); // Wait 1.5s then retry
                } else {
                    // Final Error Handler
                    renderError(e, container);
                }
            }
        }

        function renderError(e, container) {
            if (e.code === 101) {
                container.innerHTML = '<div style="text-align:center; opacity:0.5; padding:20px; font-size:13px;">æš‚æ— å¤‡å¿˜ (Class Not Found)</div>';
            } else if ((e.code === 0 && e.message.includes("Network")) || e.message === 'Query Timeout') {
                container.innerHTML = `<div style="color:red; text-align:center; font-size:12px; padding:10px; background:rgba(255,0,0,0.1); border-radius:8px;">
                    âš ï¸ ç½‘ç»œä¸ç¨³å®š<br>
                    è¯·æ£€æŸ¥æ˜¯å¦æœ‰VPNå½±å“ï¼Œæˆ–åˆ·æ–°é‡è¯•ã€‚
                 </div>`;
            } else {
                container.innerHTML = `<div style="color:red; text-align:center; font-size:12px;">Error ${e.code || 'X'}: ${e.message}</div>`;
            }
        }

        async function addMemo() {
            const input = document.getElementById('memo-input');
            const text = input.value.trim();
            if (!text) return;

            input.disabled = true;
            try {
                const Memo = AV.Object.extend('StrategyMemo');
                const memo = new Memo();
                memo.set('content', text);

                const acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                memo.setACL(acl);

                await memo.save();
                input.value = '';
                loadMemosWithRetry(3);
            } catch (e) {
                alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•: " + e.message);
            } finally {
                input.disabled = false;
                input.focus();
            }
        }

        async function deleteMemo(id) {
            if (!confirm("ç¡®è®¤åˆ é™¤ï¼Ÿ")) return;
            try {
                const memo = AV.Object.createWithoutData('StrategyMemo', id);
                await memo.destroy();
                loadMemosWithRetry(3);
            } catch (e) {
                alert("åˆ é™¤å¤±è´¥ï¼Œè¯·åˆ·æ–°");
            }
        }
    </script>
</body>

</html>